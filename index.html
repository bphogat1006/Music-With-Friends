<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Music With Friends</title>
    <link rel="shortcut icon" type="image/png" href="favicon.png"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet">
  </head>

  <body onload="onPageLoad()">
    <div class="container">
      
      <div id="request-authorization" class="row my-5">
        <div class="d-flex align-items-center mb-4">
          <img id="website-thumbnail" src="favicon.png">
          <h1 class="display-1 ms-4">Music With Friends</h1>
        </div>
        <h1 class="display-6 mb-4">Click below to authenticate with Spotify.</h1> 
        <input id="authenticate-button" class="btn btn-lg btn-primary" type="button" onclick="requestAuthorization()" value="Request Authorization"></input>
      </div>
      
      <div id="user-data" class="row my-5">

        <div id="user-profile">
          <div class="d-flex align-items-center">
            <h1 id="display-name" class="display-1 me-3">Hello, </h1>
            <img id="profile-picture" class="img-fluid rounded-pill m-3">
          </div>
        </div>

        <div id="progress-container" class="container">
          <p id="progress-info"></p>
          <div class="progress">
            <div id="progress" style="width: 0%;" class="progress-bar progress-bar-striped progress-bar-animated"></div>
          </div>
        </div>

        <div id="debug-point-system" class="container" style="display: none;">
          <button class="btn btn-primary" onclick="downloadData()">Download Data</button>
        </div>

        <div id="top-listens-information">
          <div class="d-flex align-items-center">
            <p class="display-6 my-3">Here are your top artists and tracks.</p>
            <div id="loading-top-listens" class="spinner-border ms-3 text-primary" role="status" aria-hidden="true"></div>
          </div>
          
          <select id="select-period" class="form-select form-select-lg mb-4" onchange="refetch(this)">
            <option value="short_term">Short-Term</option>
            <option value="medium_term" selected>Medium-Term</option>
            <option value="long_term">Long-Term</option>
          </select>
          
          <div class="row">
            <div class="col">
              <h3 class="p-2 text-center">Top Artists</h1>
              <ul id="top-artists-list" class="list-group list-group-flush mx-3"></ul>
            </div>
            <div class="col">
              <h3 class="p-2 text-center">Top Tracks</h1>
              <ul id="top-tracks-list" class="list-group list-group-flush mx-3"></ul>
            </div>
          </div>
        </div>

      </div>
      
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <script id="credentials"></script>
    <script id="app"></script>
    <script id="userData"></script>
    <script type="text/javascript">
      var time = Date.now()
      document.getElementById('credentials').src = 'credentials.js' + '?t=' + time
      document.getElementById('app').src = 'app.js' + '?t=' + time
      document.getElementById('userData').src = 'userData.js' + '?t=' + time
    </script>
    <script>
      function refetch(selectObject) {
        fetchPeriod = selectObject.value
        document.getElementById('top-artists-list').innerHTML = ''
        document.getElementById('top-tracks-list').innerHTML = ''
        getTopListens("artists")
        .then((data) => {
          handleTopListensResponse(data)
          return getTopListens("tracks")
        })
        .then((data) => {
          handleTopListensResponse(data)
        })
      }
    </script>
  </body>

</html>